<!-- Liste déroulante -->
<h2 id="dropdown-list">Liste déroulante</h2>

<h3>Exemples</h3>

<qc-doc-exemple caption="Exemple de liste déroulante en sélection unique sans barre de recherche">
    <qc-dropdown-list
        id="dropdown-list-single-choice"
        legend="Faites un choix:"
        enable-search
    >
        <option value="1">Option 1</option>
        <option value="2">Option 2</option>
        <option value="3">Option 3</option>
        <option value="4">Option 4</option>
        <option value="5">Option 5</option>
        <option value="6">Option 6</option>
        <option value="7">Option 7</option>
        <option value="8">Option 8</option>
        <option value="9">Option 9</option>
        <option value="10">Option 10</option>
        <option value="11">Option 11</option>
        <option value="12">Option 12</option>
        <option value="13">Option 13</option>
        <option value="14">Option 14</option>
        <option value="15">Option 15</option>
        <option value="16">Option 16</option>
    </qc-dropdown-list>

    <script>
        function mutationCallback(mutationsList, _) {
            mutationsList.forEach(mutation => {
                if (mutation.type === 'attributes') {
                    console.log(mutation.attributeName, mutation.target.value);
                }
            });
        }

        const mutationObserver = new MutationObserver(mutationCallback);

        const singleChoice = document.getElementById("dropdown-list-single-choice");
        mutationObserver.observe(singleChoice, { attributes: true });

        window.onbeforeunload = () => {
            mutationObserver.disconnect();
        }
    </script>
</qc-doc-exemple>

<qc-doc-exemple caption="Exemple de validation de formulaire avec listes déroulantes">
    <form id="dropdown-list-form">
        <qc-dropdown-list
            id="dropdown-list-restaurants"
            legend="Type de restaurant"
            placeholder="Type de restaurant"
            enable-search
            search-placeholder="Rechercher un type restaurant"
            required
            invalid-text="Veuillez choisir un type de restaurant."
        >
            <option>Pizzeria</option>
            <option>Patisserie</option>
            <option>Steakhouse</option>
            <option>Bar</option>
            <option>Casse-croûte</option>
            <option>Boîte à pâtes</option>
            <option>Restaurant à burgers</option>
        </qc-dropdown-list>

        <qc-dropdown-list
            id="dropdown-list-regions"
            legend="Régions desservies"
            placeholder="Sélectionner une région"
            width="xl"
            multiple
            enable-search
            search-placeholder="Rechercher les régions"
        >
            <option>Capitale-nationale</option>
            <option>Centre-du-Québec</option>
            <option>Montérégie</option>
            <option>Outaouais</option>
            <option>Saguenay-Lac-Saint-Jean</option>
            <option>Gaspésie-Îles-de-la-Madeleine</option>
            <option>Nord-du-Québec</option>
            <option>Bas-Saint-Laurent</option>
        </qc-dropdown-list>

        <button type="submit" class="btn btn-sm btn-primary">Envoyer</button>
    </form>

    <script>
        const dropdownListForm = document.getElementById("dropdown-list-form");

        dropdownListForm.addEventListener("submit", (event) => {
            event.preventDefault();

            let isValid = true;

            const requiredFields = dropdownListForm.querySelectorAll("qc-dropdown-list[required]");

            requiredFields.forEach(field => {
                const value = field.value?.trim();

                if (!value) {
                    field.invalid = true;
                    isValid = false;
                } else {
                    field.invalid = false;
                }
            });

            if (isValid) {
                const formEntries = dropdownListForm.querySelectorAll("qc-dropdown-list");
                let alertParts = ["Formulaire soumis avec les données suivantes :"];
                formEntries.forEach((field) => {
                    alertParts.push(`${field.legend}: ${field.value}`);
                });
                alert(alertParts.join("\n"));
            }
        });
    </script>
</qc-doc-exemple>
