<!-- Liste déroulante -->
<h2 id="dropdown-list">Liste déroulante</h2>

<h3>Exemples</h3>

<qc-doc-exemple caption="Exemple de liste déroulante en sélection unique sans barre de recherche">
    <qc-dropdown-list
        id="dropdown-list-single-choice"
        legend="Faites un choix:"
    >
        <qc-option value="1">Option 1</qc-option>
        <qc-option value="2">Option 2</qc-option>
        <qc-option value="3">Option 3</qc-option>
        <qc-option value="4">Option 4</qc-option>
        <qc-option value="5">Option 5</qc-option>
        <qc-option value="6">Option 6</qc-option>
        <qc-option value="7">Option 7</qc-option>
        <qc-option value="8">Option 8</qc-option>
        <qc-option value="9">Option 9</qc-option>
        <qc-option value="10">Option 10</qc-option>
        <qc-option value="11">Option 11</qc-option>
        <qc-option value="12">Option 12</qc-option>
        <qc-option value="13">Option 13</qc-option>
        <qc-option value="14">Option 14</qc-option>
        <qc-option value="15">Option 15</qc-option>
        <qc-option value="16">Option 16</qc-option>
    </qc-dropdown-list>

    <script>
        function mutationCallback(mutationsList, _) {
            mutationsList.forEach(mutation => {
                if (mutation.type === 'attributes') {
                    console.log(mutation.attributeName, mutation.target.value);
                }
            });
        }

        const mutationObserver = new MutationObserver(mutationCallback);

        const singleChoice = document.getElementById("dropdown-list-single-choice");
        mutationObserver.observe(singleChoice, { attributes: true });

        window.onbeforeunload = () => {
            mutationObserver.disconnect();
        }
    </script>
</qc-doc-exemple>

<qc-doc-exemple caption="Exemple de validation de formulaire avec listes déroulantes">
    <form id="dropdown-list-form">
        <qc-dropdown-list
            id="dropdown-list-restaurants"
            legend="Type de restaurant"
            placeholder="Type de restaurant"
            enable-search
            search-placeholder="Rechercher un type restaurant"
            required
            invalid-text="Veuillez choisir un type de restaurant."
        >
            <qc-option value="Pizzeria">Pizzeria</qc-option>
            <qc-option value="Patisserie">Patisserie</qc-option>
            <qc-option value="Steakhouse">Steakhouse</qc-option>
            <qc-option value="Bar">Bar</qc-option>
            <qc-option value="Casse-croûte">Casse-croûte</qc-option>
            <qc-option value="Boîte à pâtes">Boîte à pâtes</qc-option>
            <qc-option value="Restaurant à burgers">Restaurant à burgers</qc-option>
        </qc-dropdown-list>

        <qc-dropdown-list
            id="dropdown-list-regions"
            legend="Régions desservies"
            placeholder="Sélectionner une région"
            width="xl"
            multiple
            enable-search
            search-placeholder="Rechercher les régions"
        >
            <qc-option value="Capitale-nationale">Capitale-nationale</qc-option>
            <qc-option value="Centre-du-Québec">Centre-du-Québec</qc-option>
            <qc-option value="Montérégie">Montérégie</qc-option>
            <qc-option value="Outaouais">Outaouais</qc-option>
            <qc-option value="Saguenay-Lac-Saint-Jean">Saguenay-Lac-Saint-Jean</qc-option>
            <qc-option value="Gaspésie-Îles-de-la-Madeleine">Gaspésie-Îles-de-la-Madeleine</qc-option>
            <qc-option value="Nord-du-Québec">Nord-du-Québec</qc-option>
            <qc-option value="Bas-Saint-Laurent">Bas-Saint-Laurent</qc-option>
        </qc-dropdown-list>

        <button type="submit" class="btn btn-sm btn-primary">Envoyer</button>
    </form>

    <script>
        const dropdownListForm = document.getElementById("dropdown-list-form");

        dropdownListForm.addEventListener("submit", (event) => {
            event.preventDefault();

            let isValid = true;

            const requiredFields = dropdownListForm.querySelectorAll("qc-dropdown-list[required]");

            requiredFields.forEach(field => {
                const value = field.value?.trim();

                if (!value) {
                    field.invalid = true;
                    isValid = false;
                } else {
                    field.invalid = false;
                }
            });

            if (isValid) {
                const formEntries = dropdownListForm.querySelectorAll("qc-dropdown-list");
                let alertParts = ["Formulaire soumis avec les données suivantes :"];
                formEntries.forEach((field) => {
                    alertParts.push(`${field.legend}: ${field.value}`);
                });
                alert(alertParts.join("\n"));
            }
        });
    </script>
</qc-doc-exemple>
